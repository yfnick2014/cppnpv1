#设计课题、中间件方案、ACE
本章讲述“设计范式的转移”，即从独立应用体系向网络应用体系的转移。这种转移会引发两类新的挑战：一类归属于问题空间，面对的是“软件体系及设计”方面的问题；一类归属于方案空间，涉及的是“实现网络应用程序的软件工具和技术”。
##网络应用面临的挑战
在独立应用体系中，一台独立的计算机包含软件的所有组成部分，包括图形用户接口（GUI）、应用服务处理和持久数据资源等等。相反，在网络应用体系中，应用系统被划分为所谓的“服务”，供多个应用程序共享和复用。

交互式GUI、指令处理和持久数据资源被分割开来，分布在网络中的多个独立主机中。在运行期间，一个网络应用程序的控制流程驻留在一个或多个主机中。系统中的所有组成部分协同通信，根据需要相互之间传输数据和控制命令。只要使用兼容的通信协议，即使底层的网络、操作系统、硬件和编程语言种类不同，分离的组件之间也可以达成互操作性。这种跨越多个主机、将网络应用服务的职责进行委托的做法，可以带来以下好处：

1. **增强可连接性和协作性**。信息可以迅速传播给更多的潜在用户。
2. **提供性能和可伸缩性**。根据目前和预计的系统需求，可以快速、安全地改变系统配置，以调整计算资源。
3. **降低成本**。用户和应用程序可以共享昂贵的外围设备和软件，如复杂的数据库管理系统。

作为一名网络应用程序开发者，你的任务是：首先了解你的应用程序将要提供哪些服务，有哪个（哪些）现有环境可以提供这些服务；然后

（1）针对服务设计各种机制，供“服务和服务”之间、“服务和客户”之间通信时使用。

（2）确定有哪些体系结构和服务配置能够最有效地利用现有环境。

（3）利用技术和工具实现这些方案，从而消除复杂性，并设计出正确、可扩充、高性能、低维护量的软件，最终实现你的商业目标。

和独立应用程序相比，网络应用程序往往更难于设计、实现、调试、优化和监控。开发、配置网络程序时会涉及所谓“固有”及“偶发”复杂性，必须学会如何去应对这些复杂性。

*固有复杂性*是由所在领域存在的主要难题造成的，这些难题会导致网络应用开发复杂化，具体包括：

- 选择合适的通信机制，并设计良好的协议来有效使用这些机制；
- 设计合理的网络服务，以有效利用现有计算资源、并降低将来的维护成本；
- 有效使用并发机制，使系统获得可预计的、可靠的高性能；
- 管理和配置服务，以获得最大程度的系统可用性和灵活性。

*偶发复杂性*源自开发网络应用软件时使用的工具和技术存在的局限性，具体包括：

- 缺乏类型安全、可移植、可扩充的原始OS API；
- 算法分解的广泛使用，无谓地造成网络应用程序在维护和扩充上的困难；
- 网络应用汇总，核心概念和功能的不断发现和创造，造成软件生命周期的成本无谓地居高不下。

##网络应用的设计空间
本书讨论的设计空间是经过详尽的领域分析后确定的，它们基于过去10多年亲手开发数百个网络应用产品和系统时积累的设计和实现经验。领域分析是一个归纳和反馈驱动的过程，它对一个应用领域进行系统的分析，识别出其核心课题和设计空间，从而为它们找到相应的解决之道。这个过程带来以下好处。

- **为领域中的抽象概念定义了一个常用词汇表**。这一方面使得开发者能够更有效地交流；另一方面，一旦明确了问题空间中的词汇，在方案空间中寻找对应的模式和软件抽象体的工作就会得以简化。
- **提高了可复用性**。它将设计问题分为两类：

（1）和“应用的类型”相关的问题；

（2）这个领域中，所有应用共有的问题。

在一个领域中，如果将注意力集中在那些共有的设计问题上，应用程序和中间件开发者就能够抓住时机，改造或构造出可复用的软件类库。在这些类库中，如果规范的控制流程被提取出来，并经过重新整合，就可以构成中间件框架，从而显著降低后续的应用程序开发工作。在一个成熟的领域中，借助面向对象语言特性，如继承、动态绑定、参数化类型和异常，可以扩充、定制现有的中间件框架，从而系统地解决“和应用相关”的设计问题。

在网络应用领域中，开发者面临设计上的抉择。这些设计空间涉及的主要是固有复杂性的管理。

1. **通信空间**。它指的是网络应用进行交互的规则、形式和抽象层次。
2. **并发空间**。它指的是一些策略和机制，用来控制如何正确使用进程和线程，以表达多个服务实例，以及每个服务实例如何在内部使用多线程。
3. **服务空间**。它反映网络应用服务的主要性质，如每个服务实例的持续时间和结构。
4. **配置空间**。它反映的是如何识别网络服务，以及在何时将网络服务绑定在一起，以构成完整的应用。“配置”往往影响到多个服务，以及服务之间的关系。

##面向对象中间件方案
在处理网络应用的偶发复杂性和固有复杂性时，一些最成功的技术和工具主要集中在“面向对象”中间件中，它有助于管理网络应用中的复杂性和异种型。“面向对象”中间件提供了可复用的服务/协议组件和框架软件，在功能上为以下二者之间架设了桥梁：

（1）端对端应用的功能需求；

（2）底层的操作系统、网络协议栈和硬件设备。

###面向对象中间件层
![](../images/0.1.png)

一个常见的面向对象中间件体系结构，一般包括如下所述的几个层次：

- 主机基础设施中间件（Host infrastructure middleware）对OS“并发”机制和“进程间通信”机制进行封装，以获得“面向对象”网络编程能力。
- 分布式中间件（Distribution middleware）使用并扩充了主机基础设施中间件，使得一些网络编程任务自动化。这些编程任务包括：连接管理和内存管理、整编（marsharling）、解编（demarshaling）、端点和请求的多路分离（demultiplexing）、同步、多线程。使用分布式中间件，程序员就可以像开发独立应用程序那样开发分布式应用程序；也就是说，只需向目标对象请求操作，不必关心目标对象的位置、语言、OS或硬件。分布式中间件的核心是Object Request Broker（ORB），例如COM+、Java RMI、CORBA。
- 公共中间件服务（Common middleware service）扩展了分布式中间件，定义了更高层次、独立于特定领域的服务，例如，事件通知、日志记录、持久性、安全且可恢复的事务。但是，“分布式中间件”主要是管理支持“面向对象”分布式编程模型的终端系统资源，而“公共中间件服务”则是对整个分布式系统中的各种资源进行分配、调度和协调。没有“公共中间件服务”，这些“端对端”功能就得由每一个网络应用程序专门（ad hoc）实现。
- 特定领域中间件服务（Domain-specific middleware service）可以满足特定领域（例如，电信、电子商务、医疗保健、过程自动化、航空电子）的特定需求。尽管其他“面向对象”中间件层提供的是可广泛复用的“横向”机制和服务，但“特定领域”中间件服务面向的是“纵向市场”。从“商业现货”的角度来看，“特定领域”服务是如今最不成熟的中间件层。其部分原因是，一直以来都没有中间件标准来提供一个稳定的基础，用以创建“特定领域”服务。

“面向对象”中间件是开发网络应用程序的重要工具。为开发和改进网络应用，它对以下3个方面进行了改进：

1. 以战略为中心。开阔了应用程序开发者的视野，使之不拘泥于低级的OS并发及网络API。
2. 有效的可复用性。通过利用已有的开发技能，并通过将重要模式具体实现为可复用的中间件框架，来分期承担软件生命周期的开发工作。
3. 开放的标准。提供了一组可移植、可互操作的软件制品。这些制品有助于将开发者的注意力引导至更高级的软件应用体系和设计问题上。

##主机基础设施中间件的优势
**满足严格的QoS需求** 为满足“效率”和“可预见性”方面严格的QoS需求，某些类型的应用程序需要访问原始的OS IPC机制和协议。在很多传统的“分布式中间件”实现中，吞吐量和延迟上的开销十分显著，而且缺乏足够的手段来处理其他“和QoS相关”的性质，譬如抖动和可靠性。相反，主机基础设施中间件往往在保证“端对端”QoS需求上更适合，因为它允许应用程序：

- 忽略不必要的功能，例如，在同种环境中忽略整编和解编；
- 对通信行为施加精细的控制，例如，支持IP多路传输和异步I/O；
- 定制网络协议，以对网络带宽的使用实施优化，或将“共享内存”通信替换为“回送网络通信”。

**控制成本** 为了在全球竞争环境中生存，很多组织正在向“面向对象”开发过程和方法过渡。基于这一背景，主机基础设施中间件提供了功能强大、久经考验的解决方案。这些方案在消除固有和偶发复杂性时，有助于控制成本。

**改进核心技术，提高现有水平** 对主机基础设施中间件有了透彻的理解，将有助于开发者识别高级模式和服务，从而在各自应用领域获得更大的产出。基础设施中间件为将来的研究和开发提供了重要的构件。因为

- 开发者若牢固掌握了“主机基础设施中间件”涉及的设计方法和模式，就能更快地跟上软件技术的进步，从而，就能促进开发小组或团队使用更高级的中间件功能。
- 开发者若对中间件底层“发生了什么”有了透彻的理解，就更能发现新方法，进而改进网络应用。

##ACE工具包概览